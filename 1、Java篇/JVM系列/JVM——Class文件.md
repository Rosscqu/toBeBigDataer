Class文件



Class文件是一组以8个字节为基础单位的二进制流，各个数据项目严格按照顺序紧凑排列在文件之中。Class文件格式采用一种类似C语言结构题的伪结构来存储数据，这种数据结构只有两种数据类型：无符号数和表。

- 无符号数是基本数据类型，以u1、u2、u4、u8分别表示1个字节、2个字节、4个字节和8个字节的无符号数，无符号数可以用来描述数字、索引引用、数量值或者按照utf-8构成字符串值；
- 表由多个无符号数或者其他表作为数据项构成的复合数据类型。所有表命名为"_info"结尾。



Class文件结构次序：

1. 魔数：

- ​	作用：确定文件是否是一个被虚拟机接受的Class文件
- ​	大小：4个字节，值为0xCAFEBABE

2. 版本：

- ​	大小：4个字节，第5和第6个字节是次版本号，第7和第8个字节是主版本号

3. 常量池：

- ​	数据类型：表类型，即每一项常量都是一个表。

- ​	常量池存放的常量：字面量和符号引用。字面量类似于文本字符串、被final生命的常量值等；符号引用属于编译原理等概念，包括：被模块导出或者开放的包、类和接口的全限定名、字段的名称和描述符、方法的名称和描述符、方法句柄和方法类型、动态调用点和动态常量。

- ​	作用：虚拟机做类加载时，将从常量池获得对应的符号引用，再在类创建时或运行时解析、翻译到具体的内存地址之中。

  现在常量池共有17种常量类型，具体如下：

| 类型                             | 标志 | 描述                         |
| -------------------------------- | ---- | ---------------------------- |
| CONSTANT_Utf8_info               | 1    | UTF-8编码的字符串            |
| CONSTANT_Integer_info            | 3    | 整型字面量                   |
| CONSTANT_Float_info              | 4    | 浮点型字面量                 |
| CONSTANT_Long_info               | 5    | 长整型字面量                 |
| CONSTANT_Double_info             | 6    | 双精度浮点型字面量           |
| CONSTANT_Class_info              | 7    | 类或接口的符号引用           |
| CONSTANT_String_info             | 8    | 字符串类型字面量             |
| CONSTANT_Fieldref_info           | 9    | 字段的符号引用               |
| CONSTANT_Methodref_info          | 10   | 类中方法的符号引用           |
| CONSTANT_InterfaceMethodref_info | 11   | 接口中方法的符号引用         |
| CONSTANT_NameAndType_info        | 12   | 字段或方法的部分符号引用     |
| CONSTANT_MethodHandle_info       | 15   | 表示方法句柄的符号引用       |
| CONSTANT_MethodType_info         | 16   | 表示方法类型的符号引用       |
| CONSTANT_Dynamic_info            | 17   | 表示动态计算常量的符号引用   |
| CONSTANT_InvokeDynamic_info      | 18   | 表示动态方法调用点的符号引用 |
| CONSTANT_Module_info             | 19   | 表示模块                     |
| CONSTANT_Package_info            | 20   | 表示模块中开放或导出的包     |



4. 访问标志

- ​	作用：表示一些类或者接口层次的访问信息，包括：Class类是类还是接口；是否定义为public类型；是否定义为abstract类型；如果是类，是否被声明为final等。
- ​	大小：2个字节

5. 类索引、父类索引和接口索引集合

   大小：类索引和父类索引2个字节，接口索引集合是一组u2类型的数据集合；

   作用：根据这3项数据确定该类型的继承关系

6. 字段表集合

   作用：描述接口或类中声明的变量；变量包括类级变量和实例级变量，但不包括方法内的局部变量；

   | 类型           | 名称             | 数量             | 作用                               |
   | -------------- | ---------------- | ---------------- | ---------------------------------- |
   | u2             | access_flags     | 1                | 字段包含的修饰符                   |
   | u2             | name_index       | 1                | 字段的简单名称，对常量池的引用     |
   | u2             | decription_index | 1                | 字段和方法的描述符，对常量池的引用 |
   | u2             | attributes_count | 1                |                                    |
   | Attribute_info | attributes       | attributes_count |                                    |

   